/*
Bundled by minee (0.0.8) on 2023-01-21T00:30:43.954Z

Dependencies
------------
┗ users/aazuspan/geeSharp:src/entry.js (#131d113)
 ┣ users/aazuspan/geeSharp:src/sharpeners.js (#831f9f4)
 ┃┗ users/aazuspan/geeSharp:src/utils.js (#f56281e)
 ┗ users/aazuspan/geeSharp:src/metrics.js (#626188d)
  ┗ users/aazuspan/geeSharp:src/utils.js (#f56281e)
*/

var modules={"users/aazuspan/geeSharp:src/entry.js":function(exports2,_requireBundled){var sharpeners=_requireBundled("users/aazuspan/geeSharp:src/sharpeners.js"),metrics=_requireBundled("users/aazuspan/geeSharp:src/metrics.js"),_methods={GS:sharpeners.GS,HPFA:sharpeners.HPFA,IHS:sharpeners.IHS,PCA:sharpeners.PCA,SFIM:sharpeners.SFIM,brovey:sharpeners.brovey,simpleMean:sharpeners.simpleMean},_metrics={MSE:metrics.MSE,RMSE:metrics.RMSE,Q:metrics.Q,bias:metrics.bias,DIV:metrics.DIV,RASE:metrics.RASE,ERGAS:metrics.ERGAS,CC:metrics.CC,CML:metrics.CML,CMC:metrics.CMC};function sharpen(sharpenable,pan,method,args){var fn=_methods[method||"SFIM"];if(fn==null)throw new Error("Method must be one of ["+exports2.methods+"], not `"+method+"`.");return arguments.splice(2,1),fn.apply(null,arguments)}function quality(original,modified,metric,args){var fn=_metrics[metric];if(fn==null)throw new Error("Metric must be one of ["+exports2.metrics+"], not `"+metric+"`.");return arguments.splice(2,1),fn.apply(null,arguments)}return exports2.methods=Object.keys(_methods),exports2.metrics=Object.keys(_metrics),exports2.sharpen=sharpen,exports2.quality=quality,exports2},"users/aazuspan/geeSharp:src/sharpeners.js":function(exports2,_requireBundled){var utils=_requireBundled("users/aazuspan/geeSharp:src/utils.js");function brovey(img,pan,weights){var panProj=pan.projection();if(utils._isMissing(weights)){var bandNum=img.bandNames().length(),bandWeight=ee.Number(1).divide(bandNum);weights=ee.List.repeat(bandWeight,bandNum)}var intensity=utils._calculateWeightedIntensity(img,weights),intensitySharp=intensity.resample().reproject(panProj),imgBrovey=img.resample("bilinear").reproject(panProj);return imgBrovey=imgBrovey.divide(intensitySharp).multiply(pan),imgBrovey}function calculateGs(ms,gsList){var reductionParameters=ee.List(ee.List(gsList).get(0)),geometry=reductionParameters.get(0),scale=reductionParameters.get(1),maxPixels=reductionParameters.get(2),previous=ee.Image(ee.List(gsList).get(-1)),g=calculateGsCoefficient(ms,previous,geometry,scale,maxPixels),gsNew=ms.subtract(g);return ee.List(gsList).add(gsNew)}function calculateGsCoefficient(ms,gs,geometry,scale,maxPixels){var imgArray=ee.Image.cat(ms,gs).toArray(),covarMatrix=imgArray.reduceRegion({reducer:ee.Reducer.covariance(),geometry:geometry,scale:scale,maxPixels:maxPixels}),covarArray=ee.Array(covarMatrix.get("array")),covar=covarArray.get([0,1]),variance=covarArray.get([1,1]),g=covar.divide(variance);return ee.Image.constant(g)}function GS(img,pan,geometry,scale,maxPixels){utils._isMissing(geometry)&&(geometry=null),utils._isMissing(scale)&&(scale=null),utils._isMissing(maxPixels)&&(maxPixels=1e12),img=img.resample("bilinear").reproject({crs:pan.projection(),scale:pan.projection().nominalScale()});var panSim=img.reduce(ee.Reducer.mean()).clip(img.geometry()),reductionParameters=[geometry,scale,maxPixels],gsList=ee.List([reductionParameters,panSim]),msCollection=utils._multibandToCollection(img),gsCollection=ee.ImageCollection(ee.List(msCollection.iterate(calculateGs,gsList)).slice(1)),gsBands=gsCollection.toBands(),panMatch=utils._linearHistogramMatch(pan,panSim,geometry,scale,maxPixels);gsBands=ee.Image.cat(panMatch,gsBands.slice(1));var detail=panMatch.subtract(panSim),gsBandImages=utils._multibandToCollection(gsBands),gCoefficients=gsBandImages.map(function(x){return calculateGsCoefficient(x,panSim,geometry,scale,maxPixels)}),sharpBands=img.add(gCoefficients.toBands().slice(1).multiply(detail));return sharpBands}function HPFA(img,pan,kernelWidth){if(utils._isMissing(kernelWidth)){var panRes=pan.projection().nominalScale(),msRes=img.projection().nominalScale();kernelWidth=ee.Number(msRes.divide(panRes).multiply(2).add(1))}else kernelWidth=ee.Number(kernelWidth);img=img.resample("bilinear"),img=img.reproject(pan.projection()),pan=pan.resample("bilinear");var centerVal=kernelWidth.pow(2).subtract(1),center=kernelWidth.divide(2).int(),kernelRow=ee.List.repeat(-1,kernelWidth),kernel=ee.List.repeat(kernelRow,kernelWidth);kernel=kernel.set(center,ee.List(kernel.get(center)).set(center,centerVal)),kernel=ee.Kernel.fixed({weights:kernel,normalize:!0});var panHPF=pan.convolve(kernel),imgHPFA=img.add(panHPF);return imgHPFA}function IHS(img,pan){var panProj=pan.projection(),panBand=pan.bandNames().get(0);img=img.resample("bilinear").reproject(panProj);var imgHsv=img.rgbToHsv(),imgRgb=imgHsv.addBands([pan]).select(["hue","saturation",panBand]).hsvToRgb().rename(img.bandNames());return imgRgb}function PCA(img,pan,substitutePC,geometry,scale,maxPixels){utils._isMissing(substitutePC)&&(substitutePC=1),utils._isMissing(maxPixels)&&(maxPixels=1e12),img=img.resample("bilinear"),img=img.reproject(pan.projection());var bandNames=img.bandNames(),panBand=pan.bandNames().get(0),imgMean=utils._reduceImage(img,ee.Reducer.mean(),geometry,scale,maxPixels),imgCentered=img.subtract(imgMean),imgArray=imgCentered.toArray(),covar=imgArray.reduceRegion({reducer:ee.Reducer.centeredCovariance(),geometry:geometry,scale:scale,maxPixels:maxPixels}),covarArray=ee.Array(covar.get("array")),eigens=covarArray.eigen(),eigenVectors=eigens.slice(1,1),imgArray2d=imgArray.toArray(1),pcSeq=ee.List.sequence(1,bandNames.length()),pcNames=pcSeq.map(function(x){return ee.String("PC").cat(ee.Number(x).int())}),principalComponents=ee.Image(eigenVectors).matrixMultiply(imgArray2d).arrayProject([0]).arrayFlatten([pcNames]);pan=utils._linearHistogramMatch(pan,principalComponents.select(substitutePC-1),geometry,scale,maxPixels);var sharpenBands=pcNames.set(substitutePC-1,panBand);principalComponents=principalComponents.addBands(pan),principalComponents=principalComponents.select(sharpenBands);var reconstructedCentered=ee.Image(eigenVectors).matrixSolve(principalComponents.toArray().toArray(1)).arrayProject([0]).arrayFlatten([bandNames]),reconstructed=reconstructedCentered.add(imgMean);return reconstructed}function SFIM(img,pan){var imgScale=img.projection().nominalScale(),panScale=pan.projection().nominalScale(),kernelWidth=imgScale.divide(panScale),kernel=ee.Kernel.square({radius:kernelWidth.divide(2)}),panSmooth=pan.reduceNeighborhood({reducer:ee.Reducer.mean(),kernel:kernel});img=img.resample("bicubic");var sharp=img.multiply(pan).divide(panSmooth).reproject(pan.projection());return sharp}function simpleMean(img,pan){var panProj=pan.projection(),imgSharp=img.resample("bilinear").reproject(panProj);return imgSharp=imgSharp.add(pan).multiply(.5),imgSharp}return exports2.brovey=brovey,exports2.GS=GS,exports2.HPFA=HPFA,exports2.IHS=IHS,exports2.PCA=PCA,exports2.SFIM=SFIM,exports2.simpleMean=simpleMean,exports2},"users/aazuspan/geeSharp:src/metrics.js":function(exports2,_requireBundled){var utils=_requireBundled("users/aazuspan/geeSharp:src/utils.js");function bias(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var xbar=ee.Array(referenceImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),ybar=ee.Array(assessmentImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),bias2=ybar.divide(xbar).multiply(-1).add(1);return ee.Dictionary.fromLists(referenceImage.bandNames(),bias2.toList())}function CC(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var xbar=ee.Image.constant(referenceImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),ybar=ee.Image.constant(assessmentImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),a=referenceImage.subtract(xbar),b=assessmentImage.subtract(ybar),x1=ee.Array(a.multiply(b).reduceRegion({reducer:ee.Reducer.sum(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),x2=ee.Array(a.pow(2).reduceRegion({reducer:ee.Reducer.sum(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),x3=ee.Array(b.pow(2).reduceRegion({reducer:ee.Reducer.sum(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),cc=x1.divide(x2.multiply(x3).sqrt());return ee.Dictionary.fromLists(referenceImage.bandNames(),cc.toList())}function CMC(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var xvar=ee.Array(referenceImage.reduceRegion({reducer:ee.Reducer.variance(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),yvar=ee.Array(assessmentImage.reduceRegion({reducer:ee.Reducer.variance(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),xstd=ee.Array(referenceImage.reduceRegion({reducer:ee.Reducer.stdDev(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),ystd=ee.Array(assessmentImage.reduceRegion({reducer:ee.Reducer.stdDev(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),c=xstd.multiply(ystd).multiply(2).divide(xvar.add(yvar));return ee.Dictionary.fromLists(referenceImage.bandNames(),c.toList())}function CML(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var xbar=ee.Array(referenceImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),ybar=ee.Array(assessmentImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),l=xbar.multiply(ybar).multiply(2).divide(xbar.pow(2).add(ybar.pow(2)));return ee.Dictionary.fromLists(referenceImage.bandNames(),l.toList())}function DIV(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var xVar=ee.Array(referenceImage.reduceRegion({reducer:ee.Reducer.variance(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),yVar=ee.Array(assessmentImage.reduceRegion({reducer:ee.Reducer.variance(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),DIV2=yVar.divide(xVar).multiply(-1).add(1);return ee.Dictionary.fromLists(referenceImage.bandNames(),DIV2.toList())}function ERGAS(referenceImage,assessmentImage,h,l,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var h=ee.Number(h),l=ee.Number(l),msek=ee.Array(MSE(referenceImage,assessmentImage,geometry,scale,maxPixels).values()),xbark=ee.Array(referenceImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values()),bandError=ee.Number(msek.divide(xbark).toList().reduce(ee.Reducer.mean())).sqrt(),ergas=bandError.multiply(h.divide(l).multiply(100));return ergas}function MSE(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var mse=referenceImage.subtract(assessmentImage).pow(2).reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels});return mse}function Q(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var cc=ee.Array(CC(referenceImage,assessmentImage,geometry,scale,maxPixels).values()),l=ee.Array(CML(referenceImage,assessmentImage,geometry,scale,maxPixels).values()),c=ee.Array(CMC(referenceImage,assessmentImage,geometry,scale,maxPixels).values()),q=cc.multiply(l).multiply(c);return ee.Dictionary.fromLists(referenceImage.bandNames(),q.toList())}function RASE(referenceImage,assessmentImage,geometry,scale,maxPixels){utils._isMissing(maxPixels)&&(maxPixels=1e12);var meanMSE=ee.Number(MSE(referenceImage,assessmentImage,geometry,scale,maxPixels).values().reduce(ee.Reducer.mean())),xbar=referenceImage.reduceRegion({reducer:ee.Reducer.mean(),geometry:geometry,scale:scale,maxPixels:maxPixels}).values().reduce(ee.Reducer.mean()),rase=meanMSE.sqrt().multiply(ee.Number(100).divide(xbar));return rase}function RMSE(referenceImage,assessmentImage,geometry,scale,maxPixels){var mseBands=MSE(referenceImage,assessmentImage,geometry,scale,maxPixels),rmse=ee.Array(mseBands.values()).sqrt();return ee.Dictionary.fromLists(referenceImage.bandNames(),rmse.toList())}return exports2.bias=bias,exports2.CC=CC,exports2.CMC=CMC,exports2.CML=CML,exports2.DIV=DIV,exports2.ERGAS=ERGAS,exports2.MSE=MSE,exports2.Q=Q,exports2.RASE=RASE,exports2.RMSE=RMSE,exports2},"users/aazuspan/geeSharp:src/utils.js":function(exports2,_requireBundled){return exports2._multibandToCollection=function(img){return ee.ImageCollection(img.bandNames().map(function(name){return img.select([name])}))},exports2._reduceImage=function(img,reducer,geometry,scale,maxPixels){exports2._isMissing(geometry)&&(geometry=img.geometry()),exports2._isMissing(scale)&&(scale=img.projection().nominalScale()),exports2._isMissing(maxPixels)&&(maxPixels=1e12);var imgReducedVal=img.reduceRegion({reducer:reducer,geometry:geometry,scale:scale,maxPixels:maxPixels}),imgReduced=imgReducedVal.toImage(img.bandNames());return imgReduced},exports2._getImageRange=function(img,geometry,scale,maxPixels){var imgMax=exports2._reduceImage(img,ee.Reducer.max(),geometry,scale,maxPixels),imgMin=exports2._reduceImage(img,ee.Reducer.min(),geometry,scale,maxPixels),imgRange=imgMax.subtract(imgMin);return imgRange},exports2._linearHistogramMatch=function(targetImage,referenceImage,geometry,scale,maxPixels){var offsetTarget=exports2._reduceImage(targetImage,ee.Reducer.mean(),geometry,scale,maxPixels),offset=exports2._reduceImage(referenceImage,ee.Reducer.mean(),geometry,scale,maxPixels),rescale=exports2._reduceImage(referenceImage,ee.Reducer.stdDev(),geometry,scale,maxPixels).divide(exports2._reduceImage(targetImage,ee.Reducer.stdDev(),geometry,scale,maxPixels)),rescaledTarget=targetImage.subtract(offsetTarget).multiply(rescale).add(offset);return rescaledTarget},exports2._isMissing=function(x){return x==null},exports2._calculateWeightedIntensity=function(img,weights){var weigthImg=ee.Image.constant(weights),weightedImg=img.multiply(weigthImg),intensity=weightedImg.reduce(ee.Reducer.sum());return intensity},exports2}};function loads(modules2,entry){var moduleCache={},_requireBundled=function(moduleName){if(moduleCache[moduleName])return moduleCache[moduleName];var bundleExports=modules2[moduleName]({},_requireBundled);return moduleCache[moduleName]=bundleExports,bundleExports};return _requireBundled(entry)}exports=loads(modules,"users/aazuspan/geeSharp:src/entry.js");
